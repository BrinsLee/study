
**数据结构**
Java7采用普通的数组+链表,而Java 8中使用数组+链表+红黑树

**并发度**

- Java7中,每个Segment独立加锁,最大并发个数就是Segment的个数,默认是16
- Java8中,锁粒度更细,理想情况下是table数组元素的个数(数组长度)就是其支持并发的最大个数,并发度比之前有提高

**保证并发安全的原理**

- Java7采用Segment分段锁来保证安全,而Segment是继承自ReentrantLock
- Java8中放弃了Segment设计,采用Node+CAS+synchronized保证线程安全

**遇到Hash碰撞**

- Java7在Hash冲突时,使用拉链法(链表的形式)
- Java8中优先使用拉链法,在链表长度超过一定阈值时,将链表转换为红黑树,来提供查找效率

**查询时间复杂度**

- Java7遍历链表的时间复杂度是O(n)
- Java8如果变成遍历红黑树,那么时间复杂度降低为O(log(n))


--------------

1. 为什么链表长度大于8时转换为红黑树? 如果hashCode分布离散良好,并且链表符合泊松分布,那链表长度为8的概率小于千万分之一,红黑树更多的是一种保底策略,用来保证hash算法异常等极端情况下的查询效率
2. 为什么不采用仅数组+红黑树的结构?红黑树节点相比链表占用内存约大一倍,而链表较短时查找也很快,所以优先采用链表结构
