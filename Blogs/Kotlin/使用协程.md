**1ã€ä½¿ç”¨åç¨‹**

#### launchingå’ŒrunBlocking

```kotlin
//æ–¹æ³•ä¸€ ä½¿ç”¨runBlockingé¡¶å±‚å‡½æ•°ï¼Œä¸å»ºè®®ä½¿ç”¨ ä¼šé˜»å¡çº¿ç¨‹
fun main() = runBlocking {
    launch {
        delay(1000l) //åªèƒ½åœ¨åç¨‹å†…éƒ¨ä½¿ç”¨ï¼Œç”¨äºæŒ‚èµ·åç¨‹ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹
        println("World!")
    }
    println("Hello, ")
    delay(2000l)
}

//æ–¹æ³•äºŒ ä½¿ç”¨GlobalScopeå•ä¾‹å¯¹è±¡ è™½ç„¶ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œä½†ä¹Ÿä¸æ¨èï¼Œå› ä¸ºå®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œapp
//ä¸€è‡´ï¼Œä¸”ä¸èƒ½å–æ¶ˆ
GlobalScope.launch {
    getImage(imageId)
}

//æ–¹æ³•ä¸‰ è‡ªè¡Œé€šè¿‡ CoroutineContext åˆ›å»ºä¸€ä¸ª CoroutineScope å¯¹è±¡
val coroutineScope = CoroutineScope(context)
coroutineScope.launch {
    getImage(imageId)
}
```

### åç¨‹ä½œç”¨åŸŸ

- runBlockingï¼šé¡¶å±‚å‡½æ•°ï¼Œå®ƒå’ŒcoroutineScopeä¸ä¸€æ ·ï¼Œå®ƒä¼šé˜»å¡å½“å‰çº¿ç¨‹æ¥ç­‰å¾…ï¼Œåªé€‚åˆåœ¨å•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨
- GlobalScopeï¼šå…¨å±€åç¨‹ä½œç”¨åŸŸï¼Œå¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸­æ“ä½œï¼Œä¸”ä¸èƒ½å–æ¶ˆï¼Œæ‰€ä»¥ä»ä¸é€‚åˆä¸šåŠ¡å¼€å‘
- è‡ªå®šä¹‰ä½œç”¨åŸŸï¼šè‡ªå®šä¹‰åç¨‹ä½œç”¨åŸŸï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼

æ˜¾ç„¶ä¸èƒ½åœ¨Activityä¸­ä½¿ç”¨GlobalScopeï¼Œå¦‚ä¸‹ï¼š

```kotlin
class MainActivity : AppCompatActivity() {
    // 1. åˆ›å»ºä¸€ä¸ª MainScope
    val scope = MainScope()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        
        // 2. å¯åŠ¨åç¨‹
        scope.launch(Dispatchers.Unconfined) {
            val one = getResult(20)
            val two = getResult(40)
            mNumTv.text = (one + two).toString()
        }
    }

    // 3. é”€æ¯çš„æ—¶å€™é‡Šæ”¾
    override fun onDestroy() {
        super.onDestroy()

        scope.cancel()
    }

    private suspend fun getResult(num: Int): Int {
        delay(5000)
        return num * num
    }
}
```

### è°ƒåº¦å™¨

è°ƒåº¦å™¨ä½œç”¨æ˜¯å°†åç¨‹é™åˆ¶åœ¨æŒ‡å®šçš„çº¿ç¨‹æ‰§è¡Œï¼Œä¸»è¦è°ƒåº¦å™¨æœ‰

- Diapatcher.Mainï¼šæŒ‡å®šæ‰§è¡Œçº¿ç¨‹æ˜¯ä¸»çº¿ç¨‹
- Dispatcher.IOï¼šæŒ‡å®šæ‰§è¡Œçš„çº¿ç¨‹æ˜¯IOçº¿ç¨‹
- Dispatcher.Defaultï¼šé»˜è®¤è°ƒåº¦å™¨ï¼Œé€‚åˆæ‰§è¡ŒCPUå¯†é›†å‹çš„ä»»åŠ¡
- Diaptcher.Unconfinedï¼šéé™åˆ¶çš„è°ƒåº¦å™¨ï¼ŒæŒ‡å®šçš„çº¿ç¨‹å¯èƒ½ä¼šéšç€æŒ‚èµ·å‡½æ•°çš„å˜åŒ–è€Œå˜åŒ–

<img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/18/17360f939ce7897a~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.image" alt="åç¨‹è¯·æ±‚æ•°æ®è¿‡ç¨‹" style="zoom:50%;" />

#### launchå’Œasync

launchçš„ä½œç”¨æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°åç¨‹ï¼Œå®ƒè¿”å›ä¸€ä¸ªJobå¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨Job#cancel()å–æ¶ˆåç¨‹

asyncçš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªåç¨‹ï¼Œä¹‹åè¿”å›ä¸€ä¸ªDeferred<T>å¯¹è±¡ã€‚å¯ä»¥è°ƒç”¨Deferred#await()å»è·å–è¿”å›çš„å€¼

async èƒ½å¤Ÿå¹¶å‘æ‰§è¡Œä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡çš„æ—¶é—´ä¹Ÿå› æ­¤ç¼©çŸ­äº†ä¸€åŠã€‚é™¤äº†ä¸Šè¿°çš„å¹¶å‘æ‰§è¡Œä»»åŠ¡ï¼Œ`async` è¿˜å¯ä»¥å¯¹å®ƒçš„ start å…¥å‚è®¾ç½®æˆæ‡’åŠ è½½

```kotlin
val one = async(start = CoroutineStart.LAZY) { getResult(20) }
```

### suspend

ä½¿ç”¨suspendå‡½æ•°åœºæ™¯

- è€—æ—¶æ“ä½œï¼šä½¿ç”¨withContextåˆ‡æ¢åˆ°æŒ‡å®šçš„IOçº¿ç¨‹è¿›è¡Œç½‘ç»œæˆ–è€…æ•°æ®åº“è¯·æ±‚
- ç­‰å¾…æ“ä½œï¼šä½¿ç”¨delayæ–¹æ³•å»ç­‰å¾…æŸä¸ªäº‹ä»¶

ä½¿ç”¨withContextåˆ‡æ¢åˆ°æŒ‡å®šçº¿ç¨‹

```kotlin
launch(Dispatchers.Main) {              // ğŸ‘ˆ åœ¨ UI çº¿ç¨‹å¼€å§‹
    val image = getImage(imageId)
    avatarIv.setImageBitmap(image)     // ğŸ‘ˆ æ‰§è¡Œç»“æŸåï¼Œè‡ªåŠ¨åˆ‡æ¢å› UI çº¿ç¨‹
}
//                               ğŸ‘‡
suspend fun getImage(imageId: Int) = withContext(Dispatchers.IO) {
    ...
}
```

**åŒæ­¥æ–¹å¼å†™å¼‚æ­¥ä»£ç **

```kotlin
suspend fun searchItemOne() : String {
    delay(1000L)
    return "item-one"
}

suspend fun searchItemTwo() : String {
    delay(1000L)
    return "item-two"
}

fun main() = runBlocking<Unit> {
    val one = searchItemOne()
    val two = searchItemTwo()
    println("The items is ${one} and ${two}")
}
```

ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•é¡ºåºæ‰§è¡Œï¼Œä¸ºäº†è®©ä¸¤ä¸ªæ–¹æ³•åŒæ­¥æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨asyncä¸await

```kotlin
fun main() = runBlocking<Unit> {
    val one = async { searchItemOne() }
    val two = async { searchItemTwo() }
    println("The items is ${one.await()} and ${two.await()}")
}
```

asyncåˆ›å»ºä¸€ä¸ªå­åç¨‹ï¼Œè¿”å›ä¸€ä¸ªDefferedå¯¹è±¡ã€‚Defferedæ˜¯ä¸€ä¸ªéé˜»å¡å¯å–æ¶ˆçš„futureï¼Œä»–æ˜¯ä¸€ä¸ªå¸¦ç»“æœçš„job